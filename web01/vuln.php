<?php

if(isset($_GET['start'])) highlight_file(__FILE__);

// Predefined path to the flag file
$flagFilePath = '/var/www/html/flag.txt';

if (isset($_REQUEST['code'])) {
    // Allowing readfile(); with a semicolon
    if (preg_match('/^readfile\(\);\s*$/', $_REQUEST['code'])) {
        // Check if the flag file exists and is readable
        if (file_exists($flagFilePath) && is_readable($flagFilePath)) {
            readfile($flagFilePath); // Read and output the flag file content
        } else {
            echo "File does not exist or is not readable.";
        }
    } elseif (preg_match('/^readfile\((.*)\);?$/', $_REQUEST['code'], $matches)) {
        // Extract the file path, allowing for quotes
        $filePath = trim($matches[1], "'\""); // Remove quotes from around the path

        // Check if the file exists and is readable
        if (file_exists($filePath) && is_readable($filePath)) {
            readfile($filePath); // Read and output the file content
        } else {
            echo "File does not exist or is not readable. <br>";
        }
    } else {
        echo "Only file read PHP functions are allowed, Try harder and you will find the right one!! <br>";
    }
}

echo "<br> Can you read /var/www/html/flag.txt... :)";

?>
